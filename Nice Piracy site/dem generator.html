<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pirate Streams Generator</title>
</head>
<body>
    <h1>Pirate Streams Generator</h1>

    <!-- Form for adding/editing entries -->
    <form id="entryForm">
        <label for="category">Category:</label>
        <select id="category">
            <option value="">Select category</option>
        </select>
        <input type="text" id="newCategory" placeholder="New category">
        <br>
        <label for="subcategory">Subcategory:</label>
        <select id="subcategory">
            <option value="">Select subcategory</option>
        </select>
        <input type="text" id="newSubcategory" placeholder="New subcategory">
        <br>
        <label for="name">Name:</label>
        <select id="name">
            <option value="">Select name</option>
        </select>
        <input type="text" id="newName" placeholder="New name">
        <br>
        <label for="link">Link:</label>
        <input type="text" id="link" placeholder="Enter link">
        <br>
        <label for="nfo">nfo:</label>
        <input type="text" id="nfo" placeholder="Enter nfo">
        <br>
        <button type="button" onclick="addEntry()">Add/Edit Entry</button>
    </form>

    <!-- Display the current entries -->
    <h2>Current Entries (Updated Below)</h2>
    <pre id="currentEntries"></pre>

    <!-- Button for saving to file -->
    <button type="button" onclick="saveToFile()">Save to File</button>

    <!-- JavaScript to handle entry addition/editing, generate dem_pirates.js, and populate select boxes -->
    <script>
        let entries = {}; // Initialize an empty entries object

        // Function to populate select boxes based on existing entries
        function populateSelectBoxes() {
            const categoryDropdown = document.getElementById("category");
            const subcategoryDropdown = document.getElementById("subcategory");
            const nameDropdown = document.getElementById("name");

            categoryDropdown.innerHTML = '<option value="">Select category</option>';
            subcategoryDropdown.innerHTML = '<option value="">Select subcategory</option>';
            nameDropdown.innerHTML = '<option value="">Select name</option>';

            for (const category in entries) {
                categoryDropdown.innerHTML += `<option value="${category}">${category}</option>`;
            }

            categoryDropdown.addEventListener("change", function() {
                const selectedCategory = categoryDropdown.value;
                subcategoryDropdown.innerHTML = '<option value="">Select subcategory</option>';
                nameDropdown.innerHTML = '<option value="">Select name</option>';
                if (selectedCategory) {
                    for (const subcategory in entries[selectedCategory]) {
                        subcategoryDropdown.innerHTML += `<option value="${subcategory}">${subcategory}</option>`;
                    }
                }
            });

            subcategoryDropdown.addEventListener("change", function() {
                const selectedCategory = categoryDropdown.value;
                const selectedSubcategory = subcategoryDropdown.value;
                nameDropdown.innerHTML = '<option value="">Select name</option>';
                if (selectedCategory && selectedSubcategory) {
                    for (const name in entries[selectedCategory][selectedSubcategory]) {
                        nameDropdown.innerHTML += `<option value="${name}">${name}</option>`;
                    }
                }
            });
        }

        // Function to add/edit an entry
        function addEntry() {
            const category = document.getElementById("category").value || document.getElementById("newCategory").value;
            const subcategory = document.getElementById("subcategory").value || document.getElementById("newSubcategory").value;
            const name = document.getElementById("name").value || document.getElementById("newName").value;
            const link = document.getElementById("link").value;
            const nfo = document.getElementById("nfo").value;

            if (!entries[category]) {
                entries[category] = {};
            }

            if (!entries[category][subcategory]) {
                entries[category][subcategory] = {};
            }

            entries[category][subcategory][name] = { link, nfo };

            // Display the current entries
            document.getElementById("currentEntries").textContent = JSON.stringify(entries, null, 4);

            // Reset form fields
            document.getElementById("category").value = '';
            document.getElementById("newCategory").value = '';
            document.getElementById("subcategory").value = '';
            document.getElementById("newSubcategory").value = '';
            document.getElementById("name").value = '';
            document.getElementById("newName").value = '';
            document.getElementById("link").value = '';
            document.getElementById("nfo").value = '';

            // Re-populate select boxes
            populateSelectBoxes();
        }

        // Function to save entries to dem_pirates.js file
        function saveToFile() {
            const jsContent = `const entries = ${JSON.stringify(entries, null, 4)};\n`;
            const blob = new Blob([jsContent], { type: "text/javascript" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "dem_pirates.js";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load and display initial entries from dem_pirates.js
        function loadInitialEntries() {
            const script = document.createElement('script');
            script.src = 'dem_pirates.js';
            script.onload = function() {
                // Display the current entries
                document.getElementById("currentEntries").textContent = JSON.stringify(entries, null, 4);

                // Populate select boxes
                populateSelectBoxes();
            };
            document.head.appendChild(script);
        }

        // Load initial entries on page load
        window.addEventListener("load", function() {
            loadInitialEntries();
        });
    </script>
</body>
</html>
